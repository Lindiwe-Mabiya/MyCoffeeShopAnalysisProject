--- PREVIOUS CODE

SELECT
    STORE_ID,
    STORE_LOCATION,
    
    PRODUCT_ID,
    PRODUCT_CATEGORY,
    REPLACE(REPLACE(REPLACE(PRODUCT_DETAIL, ',', ''), CHAR(10), ''), CHAR(13), '') AS DETAILS_OF_PRODUCT,
    PRODUCT_TYPE,
    
    TRANSACTION_ID,
    TRANSACTION_DATE,
    TRANSACTION_TIME,

    DAYNAME(TRANSACTION_DATE) AS Day_Name,
    MONTHNAME(TRANSACTION_DATE) AS Month_Name,
    DAYOFMONTH(TRANSACTION_DATE) AS Day_of_Month,

    UNIT_PRICE,
    TRANSACTION_QTY AS Total_Quantity_Per_Transaction,

    (IFNULL(UNIT_PRICE, 0) * TRANSACTION_QTY) AS Total_Revenue,

    CASE 
        WHEN TRANSACTION_TIME BETWEEN '06:00:00' AND '08:59:00' THEN 'Morning Commute'
        WHEN TRANSACTION_TIME BETWEEN '09:00:00' AND '11:59:00' THEN 'Mid-Morning'
        WHEN TRANSACTION_TIME BETWEEN '12:00:00' AND '13:59:00' THEN 'Lunchtime & Early Afternoon'
        ELSE 'Late Afternoon'
    END AS TRANSACTION_TIME_GROUP,

    CASE 
        WHEN UNIT_PRICE <= 100 THEN 'Low Spend'
        WHEN UNIT_PRICE > 100 AND UNIT_PRICE <= 300 THEN 'Medium Spend'
        ELSE 'High Spend'
    END AS SPEND_GROUP,

    CASE 
        WHEN TRANSACTION_TIME BETWEEN '06:00:00' AND '11:30:00' THEN 'Peak Hour'
        WHEN TRANSACTION_TIME BETWEEN '12:00:00' AND '13:00:00' THEN 'Second Rush Hour'
        ELSE 'General Business Time'
    END AS TRANSACTION_PEAK_GROUP

FROM BRIGHTLEARNDB.COFFEESHOPANALYSIS.COFFEESHOP
ORDER BY TRANSACTION_DATE, TRANSACTION_TIME, TRANSACTION_ID;










--- CODE USED FROM THE PROCESSED DATA
--- I COULD HAVE ALSO DONE IT WITH IFNULL

SELECT
    COALESCE(STORE_ID, 0) AS STORE_ID,
    COALESCE(STORE_LOCATION, 'N/A') AS STORE_LOCATION,
    
    COALESCE(PRODUCT_ID, 0) AS PRODUCT_ID,
    COALESCE(PRODUCT_CATEGORY, 'N/A') AS PRODUCT_CATEGORY,
    
    COALESCE(
        REPLACE(REPLACE(REPLACE(PRODUCT_DETAIL, ',', ''), CHAR(10), ''), CHAR(13), ''), 
        'N/A'
    ) AS DETAILS_OF_PRODUCT,
    COALESCE(PRODUCT_TYPE, 'N/A') AS PRODUCT_TYPE,
    
    COALESCE(TRANSACTION_ID, 0) AS TRANSACTION_ID,
    TRANSACTION_DATE,  
    TRANSACTION_TIME, 

    COALESCE(DAYNAME(TRANSACTION_DATE), 'N/A') AS Day_Name,
    COALESCE(MONTHNAME(TRANSACTION_DATE), 'N/A') AS Month_Name,
    COALESCE(DAYOFMONTH(TRANSACTION_DATE), 0) AS Day_of_Month,

    COALESCE(UNIT_PRICE, 0) AS UNIT_PRICE,
    COALESCE(TRANSACTION_QTY, 0) AS Total_Quantity_Per_Transaction,

    (COALESCE(UNIT_PRICE, 0) * COALESCE(TRANSACTION_QTY, 0)) AS Total_Revenue,

    CASE 
        WHEN TRANSACTION_TIME BETWEEN '06:00:00' AND '08:59:00' THEN 'Morning Commute'
        WHEN TRANSACTION_TIME BETWEEN '09:00:00' AND '11:59:00' THEN 'Mid-Morning'
        WHEN TRANSACTION_TIME BETWEEN '12:00:00' AND '13:59:00' THEN 'Lunchtime & Early Afternoon'
        ELSE 'Late Afternoon'
    END AS TRANSACTION_TIME_GROUP,

    CASE 
        WHEN COALESCE(UNIT_PRICE, 0) <= 100 THEN 'Low Spend'
        WHEN COALESCE(UNIT_PRICE, 0) > 100 AND COALESCE(UNIT_PRICE, 0) <= 300 THEN 'Medium Spend'
        ELSE 'High Spend'
    END AS SPEND_GROUP,

    CASE 
        WHEN TRANSACTION_TIME BETWEEN '06:00:00' AND '11:30:00' THEN 'Peak Hour'
        WHEN TRANSACTION_TIME BETWEEN '12:00:00' AND '13:00:00' THEN 'Second Rush Hour'
        ELSE 'General Business Time'
    END AS TRANSACTION_PEAK_GROUP

FROM BRIGHTLEARNDB.COFFEESHOPANALYSIS.COFFEESHOP
GROUP BY ALL
ORDER BY TRANSACTION_DATE, TRANSACTION_TIME, TRANSACTION_ID;
